I"Ğ<h2 id="å®éªŒç›®çš„">å®éªŒç›®çš„</h2>

<ol>
  <li>æŒæ¡å•å‘¨æœŸCPUæ•°æ®é€šè·¯å›¾çš„æ„æˆã€åŸç†åŠå…¶è®¾è®¡æ–¹æ³•ï¼›</li>
  <li>æŒæ¡å•å‘¨æœŸCPUçš„å®ç°æ–¹æ³•ï¼Œä»£ç å®ç°æ–¹æ³•ï¼›</li>
  <li>è®¤è¯†å’ŒæŒæ¡æŒ‡ä»¤ä¸CPUçš„å…³ç³»ï¼›</li>
  <li>æŒæ¡æµ‹è¯•å•å‘¨æœŸCPUçš„æ–¹æ³•ã€‚</li>
</ol>

<h2 id="å®éªŒå†…å®¹">å®éªŒå†…å®¹</h2>

<p>è®¾è®¡ä¸€ä¸ªå•å‘¨æœŸCPUï¼Œè¯¥CPUè‡³å°‘èƒ½å®ç°ä»¥ä¸‹æŒ‡ä»¤åŠŸèƒ½æ“ä½œï¼ŒæŒ‡ä»¤ä¸æ ¼å¼å¦‚ä¸‹ã€‚</p>

<h3 id="ç®—æœ¯è¿ç®—æŒ‡ä»¤">ç®—æœ¯è¿ç®—æŒ‡ä»¤</h3>

<h4 id="add-rd-rs-rt">add rd rs rt</h4>

<table>
  <thead>
    <tr>
      <th>000000</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>rd(5ä½)</th>
      <th>reserved</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrdâ†rs + rtï¼›reservedä¸ºé¢„ç•™éƒ¨åˆ†ï¼Œå³æœªç”¨ï¼Œä¸€èˆ¬å¡«â€œ0â€ã€‚</p>

<h4 id="sub-rd-rs-rt">sub rd rs rt</h4>

<table>
  <thead>
    <tr>
      <th>000001</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>rd(5ä½)</th>
      <th>reserved</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrdâ†rs - rtã€‚</p>

<h4 id="addiu-rt-rs-immediate">addiu rt rs immediate</h4>

<table>
  <thead>
    <tr>
      <th>000010</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrtâ†rs + (sign-extend)immediateï¼›immediateç¬¦å·æ‰©å±•å†å‚åŠ â€œåŠ â€è¿ç®—ã€‚</p>

<h3 id="é€»è¾‘è¿ç®—æŒ‡ä»¤">é€»è¾‘è¿ç®—æŒ‡ä»¤</h3>

<h4 id="andi-rt-rs-immediate">andi rt rs immediate</h4>

<table>
  <thead>
    <tr>
      <th>010000</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrtâ†rs &amp; (zero-extend)immediateï¼›immediateåšâ€œ0â€æ‰©å±•å†å‚åŠ â€œä¸â€è¿ç®—ã€‚</p>

<h4 id="and-rd-rs-rt">and rd rs rt</h4>

<table>
  <thead>
    <tr>
      <th>010001</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>rd(5ä½)</th>
      <th>reserved</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrdâ†rs &amp; rtï¼›é€»è¾‘ä¸è¿ç®—ã€‚</p>

<h4 id="ori-rt-rs-immediate">ori rt rs immediate</h4>

<table>
  <thead>
    <tr>
      <th>010010</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>åŠŸèƒ½ï¼šrtâ†rs</td>
      <td>(zero-extend)immediateï¼›immediateåšâ€œ0â€æ‰©å±•å†å‚åŠ â€œæˆ–â€è¿ç®—ã€‚</td>
    </tr>
  </tbody>
</table>

<h4 id="or-rd-rs-rt">or rd rs rt</h4>

<table>
  <thead>
    <tr>
      <th>010011</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>rd(5ä½)</th>
      <th>reserved</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>åŠŸèƒ½ï¼šrdâ†rs</td>
      <td>rtï¼›é€»è¾‘æˆ–è¿ç®—ã€‚</td>
    </tr>
  </tbody>
</table>

<h3 id="ç§»ä½æŒ‡ä»¤">ç§»ä½æŒ‡ä»¤</h3>

<h4 id="sll-rd-rt-sa">sll rd rt sa</h4>

<table>
  <thead>
    <tr>
      <th>011000</th>
      <th>æœªç”¨</th>
      <th>rt(5ä½)</th>
      <th>rd(5ä½)</th>
      <th>sa(5ä½)</th>
      <th>reserved</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrd&lt;ï¼rtÂ«(zero-extend)saï¼Œå·¦ç§»saä½ ï¼Œ(zero-extend)saã€‚</p>

<h3 id="æ¯”è¾ƒæŒ‡ä»¤">æ¯”è¾ƒæŒ‡ä»¤</h3>

<h4 id="slti-rt-rs-immediate">slti rt rs immediate</h4>

<table>
  <thead>
    <tr>
      <th>011100</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šif (rs&lt; (sign-extend)immediate)  rt =1 else  rt=0, å¸¦ç¬¦å·æ¯”è¾ƒï¼Œè¯¦è§ALUè¿ç®—åŠŸèƒ½è¡¨ã€‚</p>

<h3 id="å­˜å‚¨å™¨è¯»å†™æŒ‡ä»¤">å­˜å‚¨å™¨è¯»/å†™æŒ‡ä»¤</h3>

<h4 id="sw-rt-immediaters">sw rt immediate(rs)</h4>

<table>
  <thead>
    <tr>
      <th>100110</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šmemory[rs+ (sign-extend)immediate]â†rtï¼›immediateç¬¦å·æ‰©å±•å†ç›¸åŠ ã€‚å³å°†rtå¯„å­˜å™¨çš„å†…å®¹ä¿å­˜åˆ°rså¯„å­˜å™¨å†…å®¹å’Œç«‹å³æ•°ç¬¦å·æ‰©å±•åçš„æ•°ç›¸åŠ ä½œä¸ºåœ°å€çš„å†…å­˜å•å…ƒä¸­ã€‚</p>

<h4 id="lw-rt-immediaters">lw rt immediate(rs)</h4>

<table>
  <thead>
    <tr>
      <th>100111</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šrt â† memory[rs + (sign-extend)immediate]ï¼›immediateç¬¦å·æ‰©å±•å†ç›¸åŠ ã€‚å³è¯»å–rså¯„å­˜å™¨å†…å®¹å’Œç«‹å³æ•°ç¬¦å·æ‰©å±•åçš„æ•°ç›¸åŠ ä½œä¸ºåœ°å€çš„å†…å­˜å•å…ƒä¸­çš„æ•°ï¼Œç„¶åä¿å­˜åˆ°rtå¯„å­˜å™¨ä¸­ã€‚</p>

<h3 id="åˆ†æ”¯æŒ‡ä»¤">åˆ†æ”¯æŒ‡ä»¤</h3>

<h4 id="beq-rs-rt-immediate">beq rs rt immediate</h4>

<table>
  <thead>
    <tr>
      <th>110000</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šif(rs=rt) pcâ†pc + 4 + (sign-extend)immediate Â«2  else pc â†pc + 4</p>

<p>ç‰¹åˆ«è¯´æ˜ï¼šimmediateæ˜¯ä»PC+4åœ°å€å¼€å§‹å’Œè½¬ç§»åˆ°çš„æŒ‡ä»¤ä¹‹é—´æŒ‡ä»¤æ¡æ•°ã€‚immediateç¬¦å·æ‰©å±•ä¹‹åå·¦ç§»2ä½å†ç›¸åŠ ã€‚ä¸ºä»€ä¹ˆè¦å·¦ç§»2ä½ï¼Ÿç”±äºè·³è½¬åˆ°çš„æŒ‡ä»¤åœ°å€è‚¯å®šæ˜¯4çš„å€æ•°ï¼ˆæ¯æ¡æŒ‡ä»¤å 4ä¸ªå­—èŠ‚ï¼‰ï¼Œæœ€ä½ä¸¤ä½æ˜¯â€œ00â€ï¼Œå› æ­¤å°†immediateæ”¾è¿›æŒ‡ä»¤ç ä¸­çš„æ—¶å€™ï¼Œæ˜¯å³ç§»äº†2ä½çš„ï¼Œä¹Ÿå°±æ˜¯ä»¥ä¸Šè¯´çš„â€œæŒ‡ä»¤ä¹‹é—´æŒ‡ä»¤æ¡æ•°â€ã€‚</p>

<h4 id="bne-rs-rt-immediate">bne rs rt immediate</h4>

<table>
  <thead>
    <tr>
      <th>110001</th>
      <th>rs(5ä½)</th>
      <th>rt(5ä½)</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šif(rs!=rt) pcâ†pc + 4 + (sign-extend)immediate Â«2  else pc â†pc + 4
ç‰¹åˆ«è¯´æ˜ï¼šä¸beqä¸åŒç‚¹æ˜¯ï¼Œä¸ç­‰æ—¶è½¬ç§»ï¼Œç›¸ç­‰æ—¶é¡ºåºæ‰§è¡Œã€‚</p>

<h4 id="bltz-rs-immediate">bltz rs immediate</h4>

<table>
  <thead>
    <tr>
      <th>110010</th>
      <th>rs(5ä½)</th>
      <th>00000</th>
      <th>immediate(16ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šif(rs&lt;$zero) pcâ†pc + 4 + (sign-extend)immediate Â«2  else pc â†pc + 4ã€‚</p>

<h3 id="è·³è½¬æŒ‡ä»¤">è·³è½¬æŒ‡ä»¤</h3>

<h4 id="j-addr">j addr</h4>

<table>
  <thead>
    <tr>
      <th>111000</th>
      <th>addr[27:2]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼š<code>pc &lt;ï¼{(pc+4)[31:28],addr[27:2],2'b00}</code>ï¼Œæ— æ¡ä»¶è·³è½¬ã€‚</p>

<p>è¯´æ˜ï¼šç”±äºMIPS32çš„æŒ‡ä»¤ä»£ç é•¿åº¦å 4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æŒ‡ä»¤åœ°å€äºŒè¿›åˆ¶æ•°æœ€ä½2ä½å‡ä¸º0ï¼Œå°†æŒ‡ä»¤åœ°å€æ”¾è¿›æŒ‡ä»¤ä»£ç ä¸­æ—¶ï¼Œå¯çœæ‰ï¼è¿™æ ·ï¼Œé™¤äº†æœ€é«˜6ä½æ“ä½œç å¤–ï¼Œè¿˜æœ‰26ä½å¯ç”¨äºå­˜æ”¾åœ°å€ï¼Œäº‹å®ä¸Šï¼Œå¯å­˜æ”¾28ä½åœ°å€ï¼Œå‰©ä¸‹æœ€é«˜4ä½ç”±pc+4æœ€é«˜4ä½æ‹¼æ¥ä¸Šã€‚</p>

<h3 id="åœæœºæŒ‡ä»¤">åœæœºæŒ‡ä»¤</h3>

<h4 id="halt">halt</h4>

<table>
  <thead>
    <tr>
      <th>111111</th>
      <th>00000000000000000000000000(26ä½)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>åŠŸèƒ½ï¼šåœæœºï¼›ä¸æ”¹å˜PCçš„å€¼ï¼ŒPCä¿æŒä¸å˜ã€‚</p>

<h2 id="å®éªŒåŸç†">å®éªŒåŸç†</h2>

<p>å•å‘¨æœŸCPUæŒ‡çš„æ˜¯ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å®Œæˆï¼Œç„¶åå¼€å§‹ä¸‹ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œï¼Œå³ä¸€æ¡æŒ‡ä»¤ç”¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆã€‚ç”µå¹³ä»ä½åˆ°é«˜å˜åŒ–çš„ç¬é—´ç§°ä¸ºæ—¶é’Ÿä¸Šå‡æ²¿ï¼Œä¸¤ä¸ªç›¸é‚»æ—¶é’Ÿä¸Šå‡æ²¿ä¹‹é—´çš„æ—¶é—´é—´éš”ç§°ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚æ—¶é’Ÿå‘¨æœŸä¸€èˆ¬ä¹Ÿç§°æŒ¯è¡å‘¨æœŸï¼ˆå¦‚æœæ™¶æŒ¯çš„è¾“å‡ºæ²¡æœ‰ç»è¿‡åˆ†é¢‘å°±ç›´æ¥ä½œä¸ºCPUçš„å·¥ä½œæ—¶é’Ÿï¼Œåˆ™æ—¶é’Ÿå‘¨æœŸå°±ç­‰äºæŒ¯è¡å‘¨æœŸã€‚è‹¥æŒ¯è¡å‘¨æœŸç»äºŒåˆ†é¢‘åå½¢æˆæ—¶é’Ÿè„‰å†²ä¿¡å·ä½œä¸ºCPUçš„å·¥ä½œæ—¶é’Ÿï¼Œè¿™æ ·ï¼Œæ—¶é’Ÿå‘¨æœŸå°±æ˜¯æŒ¯è¡å‘¨æœŸçš„ä¸¤å€ï¼‰ã€‚</p>

<h3 id="cpuåœ¨å¤„ç†æŒ‡ä»¤çš„å‡ ä¸ªæ­¥éª¤">CPUåœ¨å¤„ç†æŒ‡ä»¤çš„å‡ ä¸ªæ­¥éª¤</h3>

<pre><code class="language-mermaid">graph LR
å–æŒ‡ä»¤IF--&gt;æŒ‡ä»¤è¯‘ç ID
æŒ‡ä»¤è¯‘ç ID--&gt;æŒ‡ä»¤æ‰§è¡ŒEXE
æŒ‡ä»¤æ‰§è¡ŒEXE--&gt;å­˜å‚¨å™¨è®¿é—®MEM
å­˜å‚¨å™¨è®¿é—®MEM--&gt;ç»“æœå†™å›WB
ç»“æœå†™å›WB--&gt;å–æŒ‡ä»¤IF
</code></pre>

<p>å›¾1 CPUæŒ‡ä»¤å¤„ç†è¿‡ç¨‹</p>

<h4 id="å–æŒ‡ä»¤if">å–æŒ‡ä»¤(IF)</h4>

<p>æ ¹æ®ç¨‹åºè®¡æ•°å™¨PCä¸­çš„æŒ‡ä»¤åœ°å€ï¼Œä»å­˜å‚¨å™¨ä¸­å–å‡ºä¸€æ¡æŒ‡ä»¤ï¼ŒåŒæ—¶ï¼ŒPCæ ¹æ®æŒ‡ä»¤å­—é•¿åº¦è‡ªåŠ¨é€’å¢äº§ç”Ÿä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€éœ€è¦çš„æŒ‡ä»¤åœ°å€ï¼Œä½†é‡åˆ°â€œåœ°å€è½¬ç§»â€æŒ‡ä»¤æ—¶ï¼Œåˆ™æ§åˆ¶å™¨æŠŠâ€œè½¬ç§»åœ°å€â€é€å…¥PCï¼Œå½“ç„¶å¾—åˆ°çš„â€œåœ°å€â€éœ€è¦åšäº›å˜æ¢æ‰é€å…¥PCã€‚</p>

<h4 id="æŒ‡ä»¤è¯‘ç id">æŒ‡ä»¤è¯‘ç (ID)</h4>

<p>å¯¹å–æŒ‡ä»¤æ“ä½œä¸­å¾—åˆ°çš„æŒ‡ä»¤è¿›è¡Œåˆ†æå¹¶è¯‘ç ï¼Œç¡®å®šè¿™æ¡æŒ‡ä»¤éœ€è¦å®Œæˆçš„æ“ä½œï¼Œä»è€Œäº§ç”Ÿç›¸åº”çš„æ“ä½œæ§åˆ¶ä¿¡å·ï¼Œç”¨äºé©±åŠ¨æ‰§è¡ŒçŠ¶æ€ä¸­çš„å„ç§æ“ä½œã€‚</p>

<h4 id="æŒ‡ä»¤æ‰§è¡Œexe">æŒ‡ä»¤æ‰§è¡Œ(EXE)</h4>

<p>æ ¹æ®æŒ‡ä»¤è¯‘ç å¾—åˆ°çš„æ“ä½œæ§åˆ¶ä¿¡å·ï¼Œå…·ä½“åœ°æ‰§è¡ŒæŒ‡ä»¤åŠ¨ä½œï¼Œç„¶åè½¬ç§»åˆ°ç»“æœå†™å›çŠ¶æ€ã€‚</p>

<h4 id="å­˜å‚¨å™¨è®¿é—®mem">å­˜å‚¨å™¨è®¿é—®(MEM)</h4>

<p>æ‰€æœ‰éœ€è¦è®¿é—®å­˜å‚¨å™¨çš„æ“ä½œéƒ½å°†åœ¨è¿™ä¸ªæ­¥éª¤ä¸­æ‰§è¡Œï¼Œè¯¥æ­¥éª¤ç»™å‡ºå­˜å‚¨å™¨çš„æ•°æ®åœ°å€ï¼ŒæŠŠæ•°æ®å†™å…¥åˆ°å­˜å‚¨å™¨ä¸­æ•°æ®åœ°å€æ‰€æŒ‡å®šçš„å­˜å‚¨å•å…ƒæˆ–è€…ä»å­˜å‚¨å™¨ä¸­å¾—åˆ°æ•°æ®åœ°å€å•å…ƒä¸­çš„æ•°æ®ã€‚</p>

<h4 id="ç»“æœå†™å›wb">ç»“æœå†™å›(WB)</h4>

<p>æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœæˆ–è€…è®¿é—®å­˜å‚¨å™¨ä¸­å¾—åˆ°çš„æ•°æ®å†™å›ç›¸åº”çš„ç›®çš„å¯„å­˜å™¨ä¸­ã€‚</p>

<p>å•å‘¨æœŸCPUï¼Œæ˜¯åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å®Œæˆè¿™äº”ä¸ªé˜¶æ®µçš„å¤„ç†ã€‚</p>

<h3 id="mipsæŒ‡ä»¤çš„ä¸‰ç§æ ¼å¼">MIPSæŒ‡ä»¤çš„ä¸‰ç§æ ¼å¼</h3>

<table>
  <thead>
    <tr>
      <th>ç¼©å†™</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>op</td>
      <td>æ“ä½œç </td>
    </tr>
    <tr>
      <td>rs</td>
      <td>åªè¯»ï¼Œä¸ºç¬¬1ä¸ªæºæ“ä½œæ•°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨åœ°å€ï¼ˆç¼–å·ï¼‰æ˜¯<code>00000~11111ï¼Œ00~1F</code></td>
    </tr>
    <tr>
      <td>rt</td>
      <td>å¯è¯»å¯å†™ï¼Œä¸ºç¬¬2ä¸ªæºæ“ä½œæ•°å¯„å­˜å™¨ï¼Œæˆ–ç›®çš„æ“ä½œæ•°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨åœ°å€ï¼ˆåŒä¸Šï¼‰</td>
    </tr>
    <tr>
      <td>rd</td>
      <td>åªå†™ï¼Œä¸ºç›®çš„æ“ä½œæ•°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨åœ°å€ï¼ˆåŒä¸Šï¼‰</td>
    </tr>
    <tr>
      <td>sa</td>
      <td>ä½ç§»é‡ï¼ˆshift amtï¼‰ï¼Œç§»ä½æŒ‡ä»¤ç”¨äºæŒ‡å®šç§»å¤šå°‘ä½</td>
    </tr>
    <tr>
      <td>funct</td>
      <td>åŠŸèƒ½ç ï¼Œåœ¨å¯„å­˜å™¨ç±»å‹æŒ‡ä»¤ä¸­ï¼ˆRç±»å‹ï¼‰ç”¨æ¥æŒ‡å®šæŒ‡ä»¤çš„åŠŸèƒ½ä¸æ“ä½œç é…åˆä½¿ç”¨</td>
    </tr>
    <tr>
      <td>immediate</td>
      <td>16ä½ç«‹å³æ•°ï¼Œç”¨ä½œæ— ç¬¦å·çš„é€»è¾‘æ“ä½œæ•°ã€æœ‰ç¬¦å·çš„ç®—æœ¯æ“ä½œæ•°ã€æ•°æ®åŠ è½½ï¼ˆLaodï¼‰/æ•°æ®ä¿å­˜ï¼ˆStoreï¼‰æŒ‡ä»¤çš„æ•°æ®åœ°å€å­—èŠ‚åç§»é‡å’Œåˆ†æ”¯æŒ‡ä»¤ä¸­ç›¸å¯¹ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰çš„æœ‰ç¬¦å·åç§»é‡ï¼›</td>
    </tr>
    <tr>
      <td>address</td>
      <td>åœ°å€</td>
    </tr>
  </tbody>
</table>

<h4 id="rç±»å‹">Rç±»å‹</h4>

<table>
  <thead>
    <tr>
      <th>31-26</th>
      <th>25-21</th>
      <th>20-16</th>
      <th>15-11</th>
      <th>10-6</th>
      <th>5-0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>op</td>
      <td>rs</td>
      <td>rt</td>
      <td>rd</td>
      <td>sa</td>
      <td>func</td>
    </tr>
    <tr>
      <td>6ä½</td>
      <td>5ä½</td>
      <td>5ä½</td>
      <td>5ä½</td>
      <td>5ä½</td>
      <td>6ä½</td>
    </tr>
  </tbody>
</table>

<h4 id="iç±»å‹">Iç±»å‹</h4>

<table>
  <thead>
    <tr>
      <th>31-26</th>
      <th>25-21</th>
      <th>20-16</th>
      <th>15-0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>op</td>
      <td>rs</td>
      <td>rt</td>
      <td>immediate</td>
    </tr>
    <tr>
      <td>6ä½</td>
      <td>5ä½</td>
      <td>5ä½</td>
      <td>16ä½</td>
    </tr>
  </tbody>
</table>

<h4 id="jç±»å‹">Jç±»å‹</h4>

<table>
  <thead>
    <tr>
      <th>31-26</th>
      <th>25-0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>op</td>
      <td>address</td>
    </tr>
    <tr>
      <td>6ä½</td>
      <td>26ä½</td>
    </tr>
  </tbody>
</table>

<h3 id="å•å‘¨æœŸcpuæ•°æ®é€šè·¯å’Œæ§åˆ¶çº¿è·¯å›¾">å•å‘¨æœŸCPUæ•°æ®é€šè·¯å’Œæ§åˆ¶çº¿è·¯å›¾</h3>

<p><img src="/public/image/2018-11-23-1.jpg" alt="å•å‘¨æœŸCPUæ•°æ®é€šè·¯å’Œæ§åˆ¶çº¿è·¯å›¾" /></p>

<p>ä¸Šå›¾æ˜¯ä¸€ä¸ªç®€å•çš„åŸºæœ¬ä¸Šèƒ½å¤Ÿåœ¨å•å‘¨æœŸCPUä¸Šå®Œæˆæ‰€è¦æ±‚è®¾è®¡çš„æŒ‡ä»¤åŠŸèƒ½çš„æ•°æ®é€šè·¯å’Œå¿…è¦çš„æ§åˆ¶çº¿è·¯å›¾ã€‚</p>

<p>æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœæ€»æ˜¯åœ¨æ—¶é’Ÿä¸‹é™æ²¿ä¿å­˜åˆ°å¯„å­˜å™¨å’Œå­˜å‚¨å™¨ä¸­ï¼ŒPCçš„æ”¹å˜æ˜¯åœ¨æ—¶é’Ÿä¸Šå‡æ²¿è¿›è¡Œçš„ï¼Œè¿™æ ·ç¨³å®šæ€§è¾ƒå¥½ã€‚å¦å¤–ï¼Œå€¼å¾—æ³¨æ„çš„é—®é¢˜ï¼Œè®¾è®¡æ—¶ï¼Œç”¨æ¨¡å—åŒ–çš„æ€æƒ³æ–¹æ³•è®¾è®¡ï¼Œå…³äºALUè®¾è®¡ã€å­˜å‚¨å™¨è®¾è®¡ã€å¯„å­˜å™¨ç»„è®¾è®¡ç­‰ç­‰ï¼Œä¹Ÿæ˜¯å¿…é¡»è®¤çœŸè€ƒè™‘çš„é—®é¢˜ã€‚</p>

<p>å…¶ä¸­æŒ‡ä»¤å’Œæ•°æ®å„å­˜å‚¨åœ¨ä¸åŒå­˜å‚¨å™¨ä¸­ï¼Œå³æœ‰æŒ‡ä»¤å­˜å‚¨å™¨å’Œæ•°æ®å­˜å‚¨å™¨ã€‚è®¿é—®å­˜å‚¨å™¨æ—¶ï¼Œå…ˆç»™å‡ºå†…å­˜åœ°å€ï¼Œç„¶åç”±è¯»æˆ–å†™ä¿¡å·æ§åˆ¶æ“ä½œã€‚å¯¹äºå¯„å­˜å™¨ç»„ï¼Œå…ˆç»™å‡ºå¯„å­˜å™¨åœ°å€ï¼Œè¯»æ“ä½œæ—¶ä¸éœ€è¦æ—¶é’Ÿä¿¡å·ï¼Œè¾“å‡ºç«¯å°±ç›´æ¥è¾“å‡ºç›¸åº”æ•°æ®ï¼›è€Œåœ¨å†™æ“ä½œæ—¶ï¼Œåœ¨ WEä½¿èƒ½ä¿¡å·ä¸º1æ—¶ï¼Œåœ¨æ—¶é’Ÿè¾¹æ²¿è§¦å‘å°†æ•°æ®å†™å…¥å¯„å­˜å™¨ã€‚</p>

<h3 id="æ§åˆ¶ä¿¡å·çš„ä½œç”¨è¡¨">æ§åˆ¶ä¿¡å·çš„ä½œç”¨è¡¨</h3>

<p>ä»¥ä¸Šæ•°æ®é€šè·¯å›¾æ˜¯æ ¹æ®è¦å®ç°çš„æŒ‡ä»¤åŠŸèƒ½çš„è¦æ±‚ç”»å‡ºæ¥çš„ï¼ŒåŒæ—¶ï¼Œè¿˜å¿…é¡»ç¡®å®šALUçš„è¿ç®—åŠŸèƒ½(å½“ç„¶ï¼Œä»¥ä¸ŠæŒ‡ä»¤æ²¡æœ‰å®Œå…¨ç”¨åˆ°æä¾›çš„ALUæ‰€æœ‰åŠŸèƒ½ï¼Œä½†è‡³å°‘å¿…é¡»èƒ½å®ç°ä»¥ä¸ŠæŒ‡ä»¤åŠŸèƒ½æ“ä½œ)ã€‚ä»æ•°æ®é€šè·¯å›¾ä¸Šå¯ä»¥çœ‹å‡ºæ§åˆ¶å•å…ƒéƒ¨åˆ†éœ€è¦äº§ç”Ÿå„ç§æ§åˆ¶ä¿¡å·ï¼Œå½“ç„¶ï¼Œä¹Ÿæœ‰äº›ä¿¡å·å¿…é¡»è¦ä¼ é€ç»™æ§åˆ¶å•å…ƒã€‚ä»æŒ‡ä»¤åŠŸèƒ½è¦æ±‚å’Œæ•°æ®é€šè·¯å›¾çš„å…³ç³»å¾—å‡ºä»¥ä¸Šè¡¨1ï¼Œè¿™æ ·ï¼Œä»è¡¨1å¯ä»¥çœ‹å‡ºå„æ§åˆ¶ä¿¡å·ä¸ç›¸åº”æŒ‡ä»¤ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼Œæ ¹æ®è¿™ç§å…³ç³»å°±å¯ä»¥å¾—å‡ºæ§åˆ¶ä¿¡å·ä¸æŒ‡ä»¤ä¹‹é—´çš„å…³ç³»ï¼ˆè§ä¸‹é¢è¡¨ä¸­çš„â€œç›¸å…³æŒ‡ä»¤â€ï¼‰ï¼Œä»è€Œå†™å‡ºå„æ§åˆ¶ä¿¡å·çš„é€»è¾‘è¡¨è¾¾å¼ï¼Œè¿™æ ·æ§åˆ¶å•å…ƒéƒ¨åˆ†å°±å¯å®ç°äº†ã€‚</p>

<table>
  <thead>
    <tr>
      <th>æ§åˆ¶ä¿¡å·å</th>
      <th>çŠ¶æ€â€œ0â€</th>
      <th>çŠ¶æ€â€œ1â€</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Reset</td>
      <td>åˆå§‹åŒ–PCä¸º0</td>
      <td>PCæ¥æ”¶æ–°åœ°å€</td>
    </tr>
    <tr>
      <td>PCWre</td>
      <td>PCä¸æ›´æ”¹ï¼Œç›¸å…³æŒ‡ä»¤ï¼šhalt</td>
      <td>PCæ›´æ”¹ï¼Œç›¸å…³æŒ‡ä»¤ï¼šé™¤æŒ‡ä»¤haltå¤–</td>
    </tr>
    <tr>
      <td>ALUSrcA</td>
      <td>æ¥è‡ªå¯„å­˜å™¨å †data1è¾“å‡ºï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddã€subã€addiuã€orã€andã€andiã€oriã€sltiã€beqã€bneã€bltzã€swã€lw</td>
      <td>æ¥è‡ªç§»ä½æ•°saï¼ŒåŒæ—¶ï¼Œè¿›è¡Œ(zero-extend)saï¼Œå³ï¼Œç›¸å…³æŒ‡ä»¤ï¼šsll</td>
    </tr>
    <tr>
      <td>ALUSrcB</td>
      <td>æ¥è‡ªå¯„å­˜å™¨å †data2è¾“å‡ºï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddã€subã€orã€andã€beqã€bneã€bltz</td>
      <td>æ¥è‡ªsignæˆ–zeroæ‰©å±•çš„ç«‹å³æ•°ï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddiuã€andiã€oriã€sltiã€swã€lw</td>
    </tr>
    <tr>
      <td>DBDataSrc</td>
      <td>æ¥è‡ªALUè¿ç®—ç»“æœçš„è¾“å‡ºï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddã€addiuã€subã€oriã€orã€andã€andiã€sltiã€sll</td>
      <td>æ¥è‡ªæ•°æ®å­˜å‚¨å™¨ï¼ˆData MEMï¼‰çš„è¾“å‡ºï¼Œç›¸å…³æŒ‡ä»¤ï¼šlw</td>
    </tr>
    <tr>
      <td>RegWre</td>
      <td>æ— å†™å¯„å­˜å™¨ç»„å¯„å­˜å™¨ï¼Œç›¸å…³æŒ‡ä»¤ï¼šbeqã€bneã€bltzã€swã€halt</td>
      <td>å¯„å­˜å™¨ç»„å†™ä½¿èƒ½ï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddã€addiuã€subã€oriã€orã€andã€andiã€sltiã€sllã€lw</td>
    </tr>
    <tr>
      <td>InsMemRW</td>
      <td>å†™æŒ‡ä»¤å­˜å‚¨å™¨</td>
      <td>è¯»æŒ‡ä»¤å­˜å‚¨å™¨(Ins. Data)</td>
    </tr>
    <tr>
      <td>mRD</td>
      <td>è¾“å‡ºé«˜é˜»æ€</td>
      <td>è¯»æ•°æ®å­˜å‚¨å™¨ï¼Œç›¸å…³æŒ‡ä»¤ï¼šlw</td>
    </tr>
    <tr>
      <td>mWR</td>
      <td>æ— æ“ä½œ</td>
      <td>å†™æ•°æ®å­˜å‚¨å™¨ï¼Œç›¸å…³æŒ‡ä»¤ï¼šsw</td>
    </tr>
    <tr>
      <td>RegDst</td>
      <td>å†™å¯„å­˜å™¨ç»„å¯„å­˜å™¨çš„åœ°å€ï¼Œæ¥è‡ªrtå­—æ®µï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddiuã€andiã€oriã€sltiã€lw</td>
      <td>å†™å¯„å­˜å™¨ç»„å¯„å­˜å™¨çš„åœ°å€ï¼Œæ¥è‡ªrdå­—æ®µï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddã€subã€andã€orã€sll</td>
    </tr>
    <tr>
      <td>ExtSel</td>
      <td>(zero-extend)immediateï¼ˆ0æ‰©å±•ï¼‰ï¼Œç›¸å…³æŒ‡ä»¤ï¼šandiã€ori</td>
      <td>(sign-extend)immediateï¼ˆç¬¦å·æ‰©å±•ï¼‰ï¼Œç›¸å…³æŒ‡ä»¤ï¼šaddiuã€sltiã€swã€lwã€beqã€bneã€bltz</td>
    </tr>
  </tbody>
</table>

<h4 id="aluopçš„åŠŸèƒ½è¡¨">ALUOpçš„åŠŸèƒ½è¡¨</h4>

<table>
  <thead>
    <tr>
      <th><code>ALUOp[2..0]</code></th>
      <th>åŠŸèƒ½</th>
      <th>æè¿°</th>
      <th>ç›¸å…³æŒ‡ä»¤</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>000</td>
      <td>Y=A+B</td>
      <td>åŠ </td>
      <td>addã€addiuã€swã€lwã€jã€halt</td>
    </tr>
    <tr>
      <td>001</td>
      <td>Y=Aâ€“B</td>
      <td>å‡</td>
      <td>subã€beqã€bneã€bltz</td>
    </tr>
    <tr>
      <td>010</td>
      <td>Y=BÂ«A</td>
      <td>Bå·¦ç§»Aä½</td>
      <td>sll</td>
    </tr>
    <tr>
      <td>011</td>
      <td>Y=Aâˆ¨B</td>
      <td>æˆ–</td>
      <td>oriã€or</td>
    </tr>
    <tr>
      <td>100</td>
      <td>Y=Aâˆ§B</td>
      <td>ä¸</td>
      <td>andiã€and</td>
    </tr>
    <tr>
      <td>101</td>
      <td>Y=A&lt;B</td>
      <td>ä¸å¸¦ç¬¦å·æ¯”è¾ƒA&lt;B</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>110</td>
      <td>Y=A[31]!=B[31]?A[31]&gt;B[31]:A&lt;B</td>
      <td>å¸¦ç¬¦å·æ¯”è¾ƒA&lt;B</td>
      <td>slti</td>
    </tr>
    <tr>
      <td>111</td>
      <td>Y=A^B</td>
      <td>å¼‚æˆ–</td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<h4 id="pcsrcçš„åŠŸèƒ½è¡¨">PCSrcçš„åŠŸèƒ½è¡¨</h4>

<table>
  <thead>
    <tr>
      <th>PCSrc[1..0]</th>
      <th>åŠŸèƒ½</th>
      <th>ç›¸å…³æŒ‡ä»¤</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>00</td>
      <td>pc&lt;ï¼pc+4</td>
      <td>addã€addiuã€subã€orã€oriã€andã€andiã€sltiã€sllã€swã€lwã€beq(zero=0)ã€bne(zero=1)ã€bltz(sign=0)</td>
    </tr>
    <tr>
      <td>01</td>
      <td>pc&lt;ï¼pc+4+(sign-extend)immediateÂ«2</td>
      <td>beq(zero=1)ã€bne(zero=0)ã€bltz(sign=1)</td>
    </tr>
    <tr>
      <td>10</td>
      <td><code>pc&lt;ï¼{(pc+4)[31:28],addr[27:2],2'b00}</code></td>
      <td>j</td>
    </tr>
    <tr>
      <td>11</td>
      <td>æœªç”¨</td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<h3 id="ç›¸å…³éƒ¨ä»¶åŠå¼•è„šè¯´æ˜">ç›¸å…³éƒ¨ä»¶åŠå¼•è„šè¯´æ˜</h3>

<h4 id="instruction-memory">Instruction Memory</h4>

<p>æŒ‡ä»¤å­˜å‚¨å™¨ã€‚</p>

<table>
  <thead>
    <tr>
      <th>Iaddr</th>
      <th>æŒ‡ä»¤å­˜å‚¨å™¨åœ°å€è¾“å…¥ç«¯å£</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>IDataIn</td>
      <td>æŒ‡ä»¤å­˜å‚¨å™¨æ•°æ®è¾“å…¥ç«¯å£ï¼ˆæŒ‡ä»¤ä»£ç è¾“å…¥ç«¯å£ï¼‰</td>
    </tr>
    <tr>
      <td>IDataOut</td>
      <td>æŒ‡ä»¤å­˜å‚¨å™¨æ•°æ®è¾“å‡ºç«¯å£ï¼ˆæŒ‡ä»¤ä»£ç è¾“å‡ºç«¯å£ï¼‰</td>
    </tr>
    <tr>
      <td>RW</td>
      <td>æŒ‡ä»¤å­˜å‚¨å™¨è¯»å†™æ§åˆ¶ä¿¡å·ï¼Œä¸º0å†™ï¼Œä¸º1è¯»</td>
    </tr>
  </tbody>
</table>

<h4 id="data-memory">Data Memory</h4>

<p>æ•°æ®å­˜å‚¨å™¨ã€‚</p>

<table>
  <thead>
    <tr>
      <th>Daddr</th>
      <th>æ•°æ®å­˜å‚¨å™¨åœ°å€è¾“å…¥ç«¯å£</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DataIn</td>
      <td>æ•°æ®å­˜å‚¨å™¨æ•°æ®è¾“å…¥ç«¯å£</td>
    </tr>
    <tr>
      <td>DataOut</td>
      <td>æ•°æ®å­˜å‚¨å™¨æ•°æ®è¾“å‡ºç«¯å£</td>
    </tr>
    <tr>
      <td>RD</td>
      <td>æ•°æ®å­˜å‚¨å™¨è¯»æ§åˆ¶ä¿¡å·ï¼Œä¸º0è¯»</td>
    </tr>
    <tr>
      <td>WR</td>
      <td>æ•°æ®å­˜å‚¨å™¨å†™æ§åˆ¶ä¿¡å·ï¼Œä¸º0å†™</td>
    </tr>
  </tbody>
</table>

<h4 id="register-file">Register File</h4>

<p>å¯„å­˜å™¨ç»„ã€‚</p>

<table>
  <thead>
    <tr>
      <th>Read Reg1</th>
      <th>rså¯„å­˜å™¨åœ°å€è¾“å…¥ç«¯å£</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Read Reg2</td>
      <td>rtå¯„å­˜å™¨åœ°å€è¾“å…¥ç«¯å£</td>
    </tr>
    <tr>
      <td>Write Reg</td>
      <td>å°†æ•°æ®å†™å…¥çš„å¯„å­˜å™¨ç«¯å£ï¼Œå…¶åœ°å€æ¥æºrtæˆ–rdå­—æ®µ</td>
    </tr>
    <tr>
      <td>Write Data</td>
      <td>å†™å…¥å¯„å­˜å™¨çš„æ•°æ®è¾“å…¥ç«¯å£</td>
    </tr>
    <tr>
      <td>Read Data1</td>
      <td>rså¯„å­˜å™¨æ•°æ®è¾“å‡ºç«¯å£</td>
    </tr>
    <tr>
      <td>Read Data2</td>
      <td>rtå¯„å­˜å™¨æ•°æ®è¾“å‡ºç«¯å£</td>
    </tr>
    <tr>
      <td>WE</td>
      <td>å†™ä½¿èƒ½ä¿¡å·ï¼Œä¸º1æ—¶ï¼Œåœ¨æ—¶é’Ÿè¾¹æ²¿è§¦å‘å†™å…¥</td>
    </tr>
  </tbody>
</table>

<h4 id="alu">ALU</h4>

<p>ç®—æœ¯é€»è¾‘å•å…ƒ</p>

<table>
  <thead>
    <tr>
      <th>result</th>
      <th>ALUè¿ç®—ç»“æœ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>zero</td>
      <td>è¿ç®—ç»“æœæ ‡å¿—ï¼Œç»“æœä¸º0ï¼Œåˆ™zero=1ï¼›å¦åˆ™zero=0</td>
    </tr>
    <tr>
      <td>sign</td>
      <td>è¿ç®—ç»“æœæ ‡å¿—ï¼Œç»“æœæœ€é«˜ä½ä¸º0ï¼Œåˆ™sign=0ï¼Œæ­£æ•°ï¼›å¦åˆ™ï¼Œsign=1ï¼Œè´Ÿæ•°</td>
    </tr>
  </tbody>
</table>

<h2 id="å®éªŒå™¨æ">å®éªŒå™¨æ</h2>

<p>ç”µè„‘ä¸€å°ï¼ŒXilinx Vivado 2017.4 è½¯ä»¶ä¸€å¥—ï¼ŒBasys3å®éªŒæ¿ä¸€å—ã€‚</p>

<h2 id="å®éªŒè¿‡ç¨‹ä¸ç»“æœ">å®éªŒè¿‡ç¨‹ä¸ç»“æœ</h2>

<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>

<h4 id="singlecpuv">SingleCPU.v</h4>

<p>å•å‘¨æœŸCPUçš„é¡¶å±‚è¿æ¥æ–‡ä»¶ï¼Œä¸»è¦æ˜¯è°ƒç”¨ä¸‹å±‚æ¨¡å—å¹¶å°†å®ƒä»¬è¾“å…¥è¾“å‡ºè¿åœ¨ä¸€èµ·ï¼Œå¹¶è®¡ç®—ä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€ï¼ˆæ­£å¸¸+4æˆ–è·³è½¬ï¼‰ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module SingleCPU(
	input CLK,	//æ—¶é’Ÿä¿¡å·
	input Reset,	//ç½®é›¶ä¿¡å·
	output[31:0] CurPC,	//å½“å‰æŒ‡ä»¤åœ°å€
	output[31:0] newaddress,	//ä¸‹ä¸€ä¸ªæŒ‡ä»¤åœ°å€
	output[31:0] instcode,	//rs,rtå¯„å­˜å™¨æ‰€åœ¨æŒ‡ä»¤
	output[31:0] Reg1Out,	//å¯„å­˜å™¨ç»„rså¯„å­˜å™¨çš„å€¼
	output[31:0] Reg2Out,	//å¯„å­˜å™¨ç»„rtå¯„å­˜å™¨çš„å€¼
	output[31:0] ALU_Out,	//ALUçš„resultè¾“å‡ºå€¼
	output[31:0] WriteData	//DBæ€»çº¿å€¼
);
	wire ExtSel;	//ä½æ‰©å±•ä¿¡å·ï¼Œ1ä¸ºç¬¦å·æ‰©å±•ï¼Œ0ä¸º0æ‰©å±•
	wire PCWre;	//PCå·¥ä½œä¿¡å·ï¼Œ0ä¸æ›´æ”¹ï¼Œ1æ›´æ”¹
	wire InsMemRW;	//æŒ‡ä»¤å¯„å­˜å™¨ä¿¡å·ï¼Œ0ä¸ºå†™ï¼Œ1ä¸ºè¯»
	wire RegDst;	//æŒ‡ä»¤è¯»å–æ—¶åˆ¤æ–­æ˜¯rtè¿˜æ˜¯rdè¿›å…¥å¯„å­˜å™¨ç»„çš„å†™æ•°æ®ç«¯ï¼Œ0ä¸ºrtï¼Œ1ä¸ºrd
	wire RegWre;	//å¯„å­˜å™¨ç»„æ˜¯å¦éœ€è¦å†™åŠŸèƒ½ï¼Œ0ä¸ºæ— å†™åŠŸèƒ½ï¼Œ1ä¸ºäº›åŠŸèƒ½
	wire[2:0] ALUOp;	//ALU8ç§è¿ç®—åŠŸèƒ½é€‰æ‹©
	wire[1:0] PCSrc;	//PCæ­£å¸¸+4è¿˜æ˜¯è¦è·³è½¬ï¼Œ0ä¸ºæ­£å¸¸+4ï¼Œ1ä¸ºè·³è½¬
	wire ALUSrcA;	//å¯„å­˜å™¨ç»„Data1çš„è¾“å‡ºï¼Œ0ä¸ºå¯„å­˜å™¨æœ¬èº«è¾“å‡ºï¼Œ1ä¸ºæŒ‡ä»¤ç çš„æœ€å16ä½ç«‹å³æ•°
	wire ALUSrcB;	//å¯„å­˜å™¨ç»„Data2çš„è¾“å‡ºï¼Œ0ä½æœ¬èº«çš„è¾“å‡ºï¼Œ1ä¸ºæ‰©å±•åçš„ç«‹å³æ•°
	wire RD;	//è¯»æ•°æ®å­˜å‚¨å™¨åŠŸèƒ½ï¼Œ0æ—¶è¯»å–
	wire WR;	//å†™æ•°æ®å­˜å‚¨å™¨åŠŸèƒ½ï¼Œ1æ—¶å†™
	wire DBDataSrc;	//å†³å®šå°†ä»€ä¹ˆæ•°æ®ä¼ å…¥å¯„å­˜å™¨ç»„Write Dataç«¯ï¼Œ0ä¸ºALUç»“æœï¼Œ1ä¸ºå­˜å‚¨å™¨
	wire[4:0] WriteRegAddr;	//å¯„å­˜å™¨ç»„Write Regè¾“å…¥ç«¯
	wire[31:0] ALU_Input_A;	//ALUçš„Aè¾“å…¥ç«¯
	wire[31:0] ALU_Input_B;	//ALUçš„Bè¾“å…¥ç«¯
	wire zero;	//ALUçš„zeroè¾“å‡º
	wire sign;	//ALUçš„signè¾“å‡º
	wire[31:0] MemOut;	//å­˜å‚¨å™¨çš„è¾“å‡º
	wire[31:0] Ext_Imm;	//ä½æ‰©å±•åçš„ç«‹å³æ•°
	wire[31:0] CurPC4=CurPC+4;
	assign newaddress=	(PCSrc==2'b01)?{CurPC4[31:28],instcode[25:0],2'b00}:
						(PCSrc==2'b10)?CurPC4+(Ext_Imm&lt;&lt;2):CurPC4;
	PC pc(CLK,Reset,PCWre,newaddress,CurPC);
	ALU alu(ALU_Input_A,ALU_Input_B,ALUOp,ALU_Out,zero,sign);
	DataMemory dm(ALU_Out,CLK,RD,WR,Reg2Out,MemOut);
	SignZeroExtend sze(instcode[15:0],ExtSel,Ext_Imm);
	Multiplexer5 mux21R(RegDst,instcode[20:16],instcode[15:11],WriteRegAddr);
	Multiplexer32 mux21A(ALUSrcA,Reg1Out,{27'b000000000000000000000000000,instcode[10:6]},ALU_Input_A);
	Multiplexer32 mux21B(ALUSrcB,Reg2Out,Ext_Imm,ALU_Input_B);
	Multiplexer32 mux21RW(DBDataSrc,ALU_Out,MemOut,WriteData);
	RegisterFile rf(RegWre,CLK,instcode[25:21],instcode[20:16],WriteRegAddr,WriteData,Reg1Out,Reg2Out);
	ControlUnit cu(ExtSel,PCWre,InsMemRW,RegDst,RegWre,ALUOp,PCSrc,ALUSrcA,ALUSrcB,RD,WR,DBDataSrc,instcode[31:26],zero,sign);
	InstructionMemory im(CurPC,InsMemRW,instcode);
endmodule
</code></pre>

<h4 id="controlunitv">ControlUnit.v</h4>

<p>æ§åˆ¶ä¿¡å·æ¨¡å—ï¼Œé€šè¿‡è§£æopå¾—åˆ°è¯¥æŒ‡ä»¤çš„å„ç§æ§åˆ¶ä¿¡å·ã€‚å®šä¹‰äº†å¾ˆå¤šç”¨åˆ°çš„å¸¸é‡ï¼Œå¯è¯»æ€§è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚</p>

<p>æ§åˆ¶å•å…ƒé€šè¿‡è¾“å…¥çš„zeroé›¶æ ‡å¿—ä½ä¸å½“å‰æŒ‡ä»¤ä¸­å¯¹åº”çš„æŒ‡ä»¤éƒ¨åˆ†æ¥ç¡®å®šå½“å‰æ•´ä¸ªCPUç¨‹åºä¸­å„æ¨¡å—çš„å·¥ä½œå’Œåä½œæƒ…å†µï¼Œæ ¹æ®CPUè¿è¡Œé€»è¾‘ï¼Œäº‹å…ˆå¯¹æ•´ä¸ªCPUä¸­æ§åˆ¶ä¿¡å·çš„æ§åˆ¶ï¼Œä»¥æ­¤æ¥è¾¾åˆ°æŒ‡æŒ¥å„ä¸ªæ¨¡å—ååŒå·¥ä½œçš„ç›®çš„ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module ControlUnit(
	output ExtSel,
	output PCWre,
	output InsMemRW,
	output RegDst,
	output RegWre,
	output[2:0] ALUOp,
	output[1:0] PCSrc,
	output ALUSrcA,
	output ALUSrcB,
	output mRD,
	output mWR,
	output DBDataSrc,
	input[5:0] op,
	input zero,
	input sign
);
	parameter ADD=	6'b000000;
	parameter SUB=	6'b000001;
	parameter ADDIU=	6'b000010;
	parameter ANDI=	6'b010000;
	parameter AND=	6'b010001;
	parameter ORI=	6'b010010;
	parameter OR=	6'b010011;
	parameter SLL=	6'b011000;
	parameter SLTI=	6'b011100;
	parameter SW=	6'b100110;
	parameter LW=	6'b100111;
	parameter BEQ=	6'b110000;
	parameter BNE=	6'b110001;
	parameter BLTZ=	6'b110010;
	parameter J=	6'b111000;
	parameter HALT=	6'b111111;
	parameter _ADD=	3'b000;
	parameter _SUB=	3'b001;
	parameter _SLL=	3'b010;
	parameter _OR=	3'b011;
	parameter _AND=	3'b100;
	parameter _SLTU=	3'b101;
	parameter _SLT=	3'b110;
	parameter _XOR=	3'b111;

	assign PCWre=	op!=HALT;
	assign ALUSrcA=	op==SLL;
	assign ALUSrcB=	op==ADDIU||op==ANDI||op==ORI||op==SLTI||op==SW||op==LW;
	assign DBDataSrc=	op==LW;
	assign RegWre=	op!=BEQ&amp;&amp;op!=BNE&amp;&amp;op!=BLTZ&amp;&amp;op!=SW&amp;&amp;op!=HALT;
	assign InsMemRW=	0;
	assign mRD=	op==LW;
	assign mWR=	op==SW;
	assign RegDst=	op!=ADDIU&amp;&amp;op!=ANDI&amp;&amp;op!=ORI&amp;&amp;op!=SLTI&amp;&amp;op!=LW;
	assign ExtSel=	op!=ANDI&amp;&amp;op!=ORI;
	assign PCSrc[0]=	op==J;
	assign PCSrc[1]=	op==BEQ&amp;&amp;zero==1||op==BNE&amp;&amp;zero==0||op==BLTZ&amp;&amp;sign==1;
	assign ALUOp=	op==SUB||op==BNE||op==BEQ||op==BLTZ?_SUB:
					op==SLL?_SLL:
					op==ORI||op==OR?_OR:
					op==ANDI||op==AND?_AND:
					op==SLTI?_SLT:_ADD;
endmodule
</code></pre>

<h4 id="aluv">ALU.v</h4>

<p>è¯¥éƒ¨åˆ†ä¸ºç®—æœ¯é€»è¾‘å•å…ƒï¼Œç”¨äºé€»è¾‘æŒ‡ä»¤è®¡ç®—å’Œè·³è½¬æŒ‡ä»¤æ¯”è¾ƒã€‚ALUOpç”¨äºæ§åˆ¶ç®—æ•°çš„ç±»å‹ï¼ŒAã€Bä¸ºè¾“å…¥æ•°ï¼Œresultä¸ºè¿ç®—ç»“æœï¼Œzeroã€signä¸»è¦ç”¨äºbeqã€bneã€bltzç­‰æŒ‡ä»¤çš„åˆ¤æ–­ã€‚</p>

<p>ALUç®—æœ¯é€»è¾‘å•å…ƒçš„åŠŸèƒ½æ˜¯æ ¹æ®æ§åˆ¶ä¿¡å·ä»è¾“å…¥çš„æ•°æ®ä¸­é€‰å–å¯¹åº”çš„æ“ä½œæ•°ï¼Œæ ¹æ®æ“ä½œç è¿›è¡Œè¿ç®—å¹¶è¾“å‡ºç»“æœä¸é›¶æ ‡å¿—ä½ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module ALU(
	input[31:0] A,	//è¾“å…¥A
	input[31:0] B,	//è¾“å…¥B
	input[2:0] ALUOp,	//ALUæ“ä½œæ§åˆ¶
	output reg[31:0] result,	//ALUè¿ç®—ç»“æœ
	output zero,	//è¿ç®—ç»“æœresultçš„æ ‡å¿—ï¼Œresultä¸º0è¾“å‡º1ï¼Œå¦åˆ™è¾“å‡º0
	output sign	//è¿ç®—ç»“æœresultçš„æ­£è´Ÿæ€§ï¼ˆæœ‰ç¬¦å·æ•°çš„æƒ…å†µï¼‰ï¼Œresultä¸ºè´Ÿæ•°è¾“å‡º1ï¼Œå¦åˆ™è¾“å‡º0
);
	parameter _ADD=	3'b000;
	parameter _SUB=	3'b001;
	parameter _SLL=	3'b010;
	parameter _OR=	3'b011;
	parameter _AND=	3'b100;
	parameter _SLTU=	3'b101;
	parameter _SLT=	3'b110;
	parameter _XOR=	3'b111;

	assign zero=	result==0;
	assign sign=	result[31];

	always@(*)begin	//è¿›è¡ŒALUè®¡ç®—
		case(ALUOp)	//è¿›è¡Œè¿ç®—
		_ADD:	result=	A+B;  //åŠ æ³•
		_SUB:	result=	A-B;  //å‡æ³•
		_SLL:	result=	B&lt;&lt;A;  //Bå·¦ç§»Aä½
		_OR:	result=	A|B;  //æˆ–
		_AND:	result=	A&amp;B;  //ä¸
		_SLTU:	result=	A&lt;B;  //æ¯”è¾ƒA&lt;Bä¸å¸¦ç¬¦å·
		_SLT:	result=	A[31]!=B[31]?A[31]&gt;B[31]:A&lt;B;	//æ¯”è¾ƒA&lt;Bå¸¦ç¬¦å·
		_XOR:	result=	A^B;	//å¼‚æˆ–
		default:	result=	0;
		endcase
	end
endmodule
</code></pre>

<h4 id="datamemoryv">DataMemory.v</h4>

<p>è¯¥éƒ¨åˆ†æ§åˆ¶å†…å­˜å­˜å‚¨ï¼Œç”¨äºå†…å­˜å­˜å‚¨ã€è¯»å†™ã€‚ç”¨255å¤§å°çš„8ä½å¯„å­˜å™¨æ•°ç»„æ¨¡æ‹Ÿå†…å­˜ï¼Œé‡‡ç”¨å°ç«¯æ¨¡å¼ã€‚DataMenRWæ§åˆ¶å†…å­˜è¯»å†™ã€‚ç”±äºæŒ‡ä»¤ä¸ºçœŸå®åœ°å€ï¼Œæ‰€ä»¥ä¸éœ€è¦<code>&lt;&lt;2</code>ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module DataMemory(
	input[31:0] DAddr,
	input CLK,
	input mRD,
	input mWR,
	input[31:0] DataIn,
	output reg[31:0] DataOut
);
	reg[7:0] dataMemory [255:0];
	always@(mRD or DAddr)begin
		if(mRD)begin
			DataOut[7:0]=	dataMemory[DAddr+3];
			DataOut[15:8]=	dataMemory[DAddr+2];
			DataOut[23:16]=	dataMemory[DAddr+1];
			DataOut[31:24]=	dataMemory[DAddr];
		end
	end
	always@(negedge CLK)begin	//æ€»æ˜¯åœ¨æ—¶é’Ÿä¸‹é™æ²¿åˆ°æ¥æ—¶è§¦å‘
		if(mWR)begin
			dataMemory[DAddr+3]&lt;=	DataIn[7:0];
			dataMemory[DAddr+2]&lt;=	DataIn[15:8];
			dataMemory[DAddr+1]&lt;=	DataIn[23:16];
			dataMemory[DAddr]&lt;=	DataIn[31:24];
		end
	end
endmodule
</code></pre>

<h4 id="instructionmemoryv">InstructionMemory.v</h4>

<p>è¯¥éƒ¨åˆ†ä¸ºæŒ‡ä»¤å¯„å­˜å™¨ï¼Œé€šè¿‡ä¸€ä¸ª256å¤§å°çš„8ä½å¯„å­˜å™¨æ•°ç»„æ¥ä¿å­˜ä»æ–‡ä»¶è¾“å…¥çš„å…¨éƒ¨æŒ‡ä»¤ã€‚ç„¶åé€šè¿‡è¾“å…¥çš„åœ°å€ï¼Œæ‰¾åˆ°ç›¸åº”çš„æŒ‡ä»¤ï¼Œè¾“å‡ºåˆ°IDataOutã€‚</p>

<p>æŒ‡ä»¤å­˜å‚¨å™¨çš„åŠŸèƒ½æ˜¯å­˜å‚¨è¯»å…¥çš„æ‰€æœ‰32-bitä½å®½çš„æŒ‡ä»¤ï¼Œæ ¹æ®ç¨‹åºè®¡æ•°å™¨PCä¸­çš„æŒ‡ä»¤åœ°å€è¿›è¡Œå–æŒ‡ä»¤æ“ä½œå¹¶å¯¹æŒ‡ä»¤ç±»å‹è¿›è¡Œåˆ†æï¼Œé€šè¿‡æŒ‡ä»¤ç±»å‹å¯¹æ‰€å–æŒ‡ä»¤çš„å„å­—æ®µè¿›è¡ŒåŒºåˆ†è¯†åˆ«ï¼Œæœ€åå°†å¯¹åº”éƒ¨åˆ†ä¼ é€’ç»™å…¶ä»–æ¨¡å—è¿›è¡Œåç»­å¤„ç†ã€‚</p>

<p>æŒ‡ä»¤å­˜å‚¨å™¨ä¸­æ¯ä¸ªå•å…ƒçš„ä½å®½ä¸º8-bitï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨æ¯æ¡32-bitä½å®½çš„æŒ‡ä»¤éƒ½éœ€è¦å æ®4ä¸ªå•å…ƒï¼Œæ‰€ä»¥ç¬¬nï¼ˆnå¤§äºæˆ–ç­‰äº0ï¼‰æ¡æŒ‡ä»¤æ‰€å¯¹åº”çš„èµ·å§‹åœ°å€ä¸º4nï¼Œä¸”å æ®ç¬¬4nï¼Œ4n+1ï¼Œ4n+2ï¼Œ4n+3è¿™å››ä¸ªå•å…ƒã€‚å–å‡ºæŒ‡ä»¤å°±æ˜¯å°†è¿™å››ä¸ªå•å…ƒåˆ†åˆ«å–å‡ºï¼Œå› ä¸ºæŒ‡ä»¤çš„å­˜å‚¨æœä»é«˜ä½æŒ‡ä»¤å­˜å‚¨åœ¨ä½ä½åœ°å€çš„è§„åˆ™ï¼Œæ‰€ä»¥4nå•å…ƒä¸­çš„å­—æ®µæ˜¯è¯¥æ¡æŒ‡ä»¤çš„æœ€é«˜8ä½ï¼Œåé¢ä»¥æ­¤ç±»æ¨ï¼Œå¹¶é€šè¿‡å·¦ç§»æ“ä½œå°†æŒ‡ä»¤çš„å››ä¸ªå•å…ƒéƒ¨åˆ†ç§»åŠ¨åˆ°ç›¸å¯¹åº”çš„ä½ç½®ï¼Œä»¥æ­¤æ¥å¾—åˆ°æ‰€å­˜æŒ‡ä»¤ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module InstructionMemory(
	input[31:0] IAddr,
	input RW,
	output reg[31:0] IDataOut
);
	reg[7:0] InstMemory[255:0];
	initial begin	//æ­¤å¤„ä¸ºç»å¯¹åœ°å€ï¼Œæ³¨æ„æ–œæ æ–¹å‘
		$readmemb("C:/Users/wukan/Documents/VIVADO/SingleCPU/input.txt",InstMemory);
	end
	always@(IAddr or RW)begin
		if(RW==0)begin
			IDataOut=	{InstMemory[IAddr],InstMemory[IAddr+1],InstMemory[IAddr+2],InstMemory[IAddr+3]};
		end
	end
endmodule
</code></pre>

<h4 id="multiplexer32v">Multiplexer32.v</h4>

<p>ä¸‰åäºŒçº¿åŒè·¯é€‰æ‹©å™¨ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module Multiplexer32(
	input Select,
	input[31:0] DataIn1,
	input[31:0] DataIn2,
	output[31:0] DataOut
);
	assign DataOut=	Select?DataIn2:DataIn1;
endmodule
</code></pre>

<h4 id="multiplexer5v">Multiplexer5.v</h4>

<p>äº”çº¿åŒè·¯é€‰æ‹©å™¨ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module Multiplexer5(
	input Select,
	input[4:0] DataIn1,
	input[4:0] DataIn2,
	output[4:0] DataOut
);
	assign DataOut=	Select?DataIn2:DataIn1;
endmodule
</code></pre>

<h4 id="pcv">PC.v</h4>

<p>CLKä¸Šå‡æ²¿è§¦å‘ï¼Œæ›´æ”¹æŒ‡ä»¤åœ°å€ã€‚ç”±äºæŒ‡ä»¤åœ°å€å­˜å‚¨åœ¨å¯„å­˜å™¨é‡Œï¼Œä¸€å¼€å§‹éœ€è¦èµ‹currentAddressä¸º0ã€‚Resetæ˜¯é‡ç½®ä¿¡å·ï¼Œå½“ä¸º1æ—¶ï¼ŒæŒ‡ä»¤å¯„å­˜å™¨åœ°å€é‡ç½®ã€‚PCWreçš„ä½œç”¨ä¸ºä¿ç•™ç°åœºï¼Œå¦‚æœPCWreä¸º0ï¼ŒæŒ‡ä»¤åœ°å€ä¸å˜ã€‚</p>

<p>PCç¨‹åºè®¡æ•°å™¨ç”¨äºå­˜æ”¾å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼Œå½“PCçš„å€¼å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼ŒCPUä¼šæ ¹æ®ç¨‹åºè®¡æ•°å™¨PCä¸­æ–°å¾—åˆ°çš„æŒ‡ä»¤åœ°å€ï¼Œä»æŒ‡ä»¤å­˜å‚¨å™¨ä¸­å–å‡ºå¯¹åº”åœ°å€çš„æŒ‡ä»¤ã€‚åœ¨å•å‘¨æœŸCPUçš„è¿è¡Œå‘¨æœŸä¸­ï¼ŒPCå€¼çš„å˜åŒ–æ˜¯æœ€å…ˆçš„ï¼Œè€Œä¸”æ˜¯æ ¹æ®PCSrcæ§åˆ¶ä¿¡å·çš„å€¼é€‰æ‹©æŒ‡ä»¤åœ°å€æ˜¯è¦è¿›è¡ŒPC+4æˆ–è€…è·³è½¬ç­‰æ“ä½œã€‚è‹¥PCç¨‹åºè®¡æ•°å™¨æ£€æµ‹åˆ°Resetè¾“å…¥ä¿¡å·ä¸º0æ—¶ï¼Œåˆ™å¯¹ç¨‹åºè®¡æ•°å™¨å­˜å‚¨çš„å½“å‰æŒ‡ä»¤åœ°å€è¿›è¡Œæ¸…é›¶å¤„ç†ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module PC(
	input CLK,
	input Reset,
	input PCWre,
	input[31:0] newAddress,
	output reg[31:0] PCAddr
);
	initial begin
		PCAddr=	0;
	end
	always@(posedge CLK or negedge Reset)begin
		if(Reset==0)begin
			PCAddr=	0;
		end
		else if(PCWre)begin
			PCAddr=	newAddress;
		end
	end
endmodule
</code></pre>

<h4 id="registerfilev">RegisterFile.v</h4>

<p>è¯¥éƒ¨åˆ†ä¸ºå¯„å­˜å™¨è¯»å†™å•å…ƒï¼Œå‚¨å­˜å¯„å­˜å™¨ç»„ï¼Œå¹¶æ ¹æ®åœ°å€å¯¹å¯„å­˜å™¨ç»„è¿›è¡Œè¯»å†™ã€‚WEçš„ä½œç”¨æ˜¯æ§åˆ¶å¯„å­˜å™¨æ˜¯å¦å†™å…¥ã€‚åŒä¸Šï¼Œé€šè¿‡ä¸€ä¸ª32å¤§å°çš„32ä½å¯„å­˜å™¨æ•°ç»„æ¥æ¨¡æ‹Ÿå¯„å­˜å™¨ï¼Œå¼€å§‹æ—¶å…¨éƒ¨ç½®0ã€‚é€šè¿‡è®¿é—®å¯„å­˜å™¨çš„åœ°å€ï¼Œæ¥è·å–å¯„å­˜å™¨é‡Œé¢çš„å€¼ï¼Œå¹¶è¿›è¡Œæ“ä½œã€‚ï¼ˆç”±äº$0æ’ä¸º0ï¼Œæ‰€ä»¥å†™å…¥å¯„å­˜å™¨çš„åœ°å€ä¸èƒ½ä¸º0ï¼‰</p>

<p>å¯„å­˜å™¨ç»„ä¸­çš„æ¯ä¸ªå¯„å­˜å™¨ä½å®½32-bit,æ˜¯å­˜æ”¾ALUè®¡ç®—æ‰€éœ€è¦çš„ä¸´æ—¶æ•°æ®çš„,ä¸æ•°æ®å­˜å‚¨å™¨ä¸åŒï¼Œå¯èƒ½ä¼šåœ¨ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è¢«å¤šæ¬¡è¦†ç›–ï¼Œè€Œæ•°æ®å­˜å‚¨å™¨å†…çš„æ•°æ®ä¸€èˆ¬åªæœ‰swæŒ‡ä»¤æ‰èƒ½è¿›è¡Œä¿®æ”¹è¦†ç›–ã€‚å¯„å­˜å™¨ç»„ä¼šæ ¹æ®æ“ä½œç opCodeä¸rsï¼Œrtå­—æ®µç›¸åº”çš„åœ°å€è¯»å–æ•°æ®,åŒæ—¶å°†rsï¼Œrtå¯„å­˜å™¨çš„åœ°å€å’Œå…¶ä¸­çš„æ•°æ®è¾“å‡ºï¼Œåœ¨CLKçš„ä¸‹é™æ²¿åˆ°æ¥æ—¶å°†æ•°æ®å­˜æ”¾åˆ°rdæˆ–è€…rtå­—æ®µçš„ç›¸åº”åœ°å€çš„å¯„å­˜å™¨å†…ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module RegisterFile(
	input WE,
	input CLK,
	input[4:0] ReadReg1,
	input[4:0] ReadReg2,
	input[4:0] WriteReg,
	input[31:0] WriteData,
	output[31:0] ReadData1,
	output[31:0] ReadData2
);
	reg[31:0] registers[0:31];
	integer i;
	initial begin	//åˆå§‹æ—¶ï¼Œå°†32ä¸ªå¯„å­˜å™¨å…¨éƒ¨èµ‹å€¼ä¸º0
		for(i=0; i&lt;32; i=i+1)registers[i]&lt;=	0;
	end
	assign ReadData1=	ReadReg1?registers[ReadReg1]:0;
	assign ReadData2=	ReadReg2?registers[ReadReg2]:0;
	always@(negedge CLK)begin
		if(WriteReg&amp;&amp;WE)begin
			registers[WriteReg]=	WriteData;
		end
	end
endmodule
</code></pre>

<h4 id="signzeroextendv">SignZeroExtend.v</h4>

<p>æ¯”è¾ƒç®€å•çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºç«‹å³æ•°çš„æ‰©å±•ã€‚ExtSelä¸ºæ§åˆ¶è¡¥ä½ä¿¡å·ã€‚åˆ¤æ–­åï¼Œå°†extendImmediateçš„å‰16ä½å…¨è¡¥1æˆ–0å³å¯ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module SignZeroExtend(
	input[15:0] immediate,
	input ExtSel,
	output[31:0] extendImmediate
);
	assign extendImmediate=	{ExtSel&amp;&amp;immediate[15]?16'hffff:16'h0000,immediate};
endmodule
</code></pre>

<h3 id="ä»¿çœŸæ£€éªŒ">ä»¿çœŸæ£€éªŒ</h3>

<p>å°†æŒ‡ä»¤è½¬æ¢æˆäºŒè¿›åˆ¶ä»£ç ï¼Œå¦‚ä¸‹è¡¨ï¼š</p>

<table>
  <thead>
    <tr>
      <th>åœ°å€</th>
      <th>æ±‡ç¼–ç¨‹åº</th>
      <th>opï¼ˆ6ï¼‰</th>
      <th>rs(5)</th>
      <th>rt(5)</th>
      <th>rd(5)/immediate(16)</th>
      <th>16è¿›åˆ¶æ•°ä»£ç </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x00000000</td>
      <td><code>addiu $1,$0,8</code></td>
      <td>000010</td>
      <td>00000</td>
      <td>00001</td>
      <td>00000000 00001000</td>
      <td>08010008</td>
    </tr>
    <tr>
      <td>0x00000004</td>
      <td><code>ori $2,$0,2</code></td>
      <td>010010</td>
      <td>00000</td>
      <td>00010</td>
      <td>00000000 00000010</td>
      <td>48020002</td>
    </tr>
    <tr>
      <td>0x00000008</td>
      <td><code>add $3,$2,$1</code></td>
      <td>000000</td>
      <td>00010</td>
      <td>00001</td>
      <td>00011000 00000000</td>
      <td>00411800</td>
    </tr>
    <tr>
      <td>0x0000000C</td>
      <td><code>sub $5,$3,$2</code></td>
      <td>000001</td>
      <td>00011</td>
      <td>00010</td>
      <td>00101000 00000000</td>
      <td>04622800</td>
    </tr>
    <tr>
      <td>0x00000010</td>
      <td><code>and $4,$5,$2</code></td>
      <td>010001</td>
      <td>00101</td>
      <td>00010</td>
      <td>00100000 00000000</td>
      <td>44a22000</td>
    </tr>
    <tr>
      <td>0x00000014</td>
      <td><code>or $8,$4,$2</code></td>
      <td>010011</td>
      <td>00100</td>
      <td>00010</td>
      <td>01000000 00000000</td>
      <td>4c824000</td>
    </tr>
    <tr>
      <td>0x00000018</td>
      <td><code>sll $8,$8,1</code></td>
      <td>011000</td>
      <td>00000</td>
      <td>01000</td>
      <td>01000000 01000000</td>
      <td>60084040</td>
    </tr>
    <tr>
      <td>0x0000001C</td>
      <td><code>bne $8,$1,-2</code></td>
      <td>110001</td>
      <td>01000</td>
      <td>00001</td>
      <td>11111111 11111110</td>
      <td>c501fffe</td>
    </tr>
    <tr>
      <td>0x00000020</td>
      <td><code>slti $6,$2,4</code></td>
      <td>011100</td>
      <td>00010</td>
      <td>00110</td>
      <td>00000000 00000100</td>
      <td>70460004</td>
    </tr>
    <tr>
      <td>0x00000024</td>
      <td><code>slti $7,$6,0</code></td>
      <td>011100</td>
      <td>00110</td>
      <td>00111</td>
      <td>00000000 00000000</td>
      <td>70c70000</td>
    </tr>
    <tr>
      <td>0x00000028</td>
      <td><code>addiu $7,$7,8</code></td>
      <td>000010</td>
      <td>00111</td>
      <td>00111</td>
      <td>00000000 00001000</td>
      <td>08e70008</td>
    </tr>
    <tr>
      <td>0x0000002C</td>
      <td><code>beq $7,$1,-2</code></td>
      <td>110000</td>
      <td>00111</td>
      <td>00001</td>
      <td>11111111 11111110</td>
      <td>c0e1fffe</td>
    </tr>
    <tr>
      <td>0x00000030</td>
      <td><code>sw $2,4($1)</code></td>
      <td>100110</td>
      <td>00001</td>
      <td>00010</td>
      <td>00000000 00000100</td>
      <td>98220004</td>
    </tr>
    <tr>
      <td>0x00000034</td>
      <td><code>lw $9,4($1)</code></td>
      <td>100111</td>
      <td>00001</td>
      <td>01001</td>
      <td>00000000 00000100</td>
      <td>9c290004</td>
    </tr>
    <tr>
      <td>0x00000038</td>
      <td><code>addiu $10,$0,-2</code></td>
      <td>000010</td>
      <td>00000</td>
      <td>01010</td>
      <td>11111111 11111110</td>
      <td>080afffe</td>
    </tr>
    <tr>
      <td>0x0000003C</td>
      <td><code>addiu $10,$10,1</code></td>
      <td>000010</td>
      <td>01010</td>
      <td>01010</td>
      <td>00000000 00000001</td>
      <td>094a0001</td>
    </tr>
    <tr>
      <td>0x00000040</td>
      <td><code>bltz $10,-2</code></td>
      <td>110010</td>
      <td>01010</td>
      <td>00000</td>
      <td>11111111 11111110</td>
      <td>c940fffe</td>
    </tr>
    <tr>
      <td>0x00000044</td>
      <td><code>andi $11,$2,2</code></td>
      <td>010000</td>
      <td>00010</td>
      <td>01011</td>
      <td>00000000 00000010</td>
      <td>404b0002</td>
    </tr>
    <tr>
      <td>0x00000048</td>
      <td><code>j 0x00000050</code></td>
      <td>111000</td>
      <td>00000</td>
      <td>00000</td>
      <td>00000000 00010100</td>
      <td>e0000014</td>
    </tr>
    <tr>
      <td>0x0000004C</td>
      <td><code>or $8,$4,$2</code></td>
      <td>010011</td>
      <td>00100</td>
      <td>00010</td>
      <td>01000000 00000000</td>
      <td>4c824000</td>
    </tr>
    <tr>
      <td>0x00000050</td>
      <td><code>halt</code></td>
      <td>111111</td>
      <td>00000</td>
      <td>00000</td>
      <td>00000000 00000000</td>
      <td>fc000000</td>
    </tr>
  </tbody>
</table>

<h4 id="inputtxt">input.txt</h4>

<pre><code class="language-bash">00001000 00000001 00000000 00001000
01001000 00000010 00000000 00000010
00000000 01000001 00011000 00000000
00000100 01100010 00101000 00000000
01000100 10100010 00100000 00000000
01001100 10000010 01000000 00000000
01100000 00001000 01000000 01000000
11000101 00000001 11111111 11111110
01110000 01000110 00000000 00000100
01110000 11000111 00000000 00000000
00001000 11100111 00000000 00001000
11000000 11100001 11111111 11111110
10011000 00100010 00000000 00000100
10011100 00101001 00000000 00000100
00001000 00001010 11111111 11111110
00001001 01001010 00000000 00000001
11001001 01000000 11111111 11111110
01000000 01001011 00000000 00000010
11100000 00000000 00000000 00010100
01001100 10000010 01000000 00000000
11111100 00000000 00000000 00000000
</code></pre>

<h4 id="simv">Sim.v</h4>

<p>ä»¿çœŸæ¨¡å—ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module Sim;
	reg CLK;	//æ—¶é’Ÿä¿¡å·
	reg Reset;	//ç½®é›¶ä¿¡å·
	SingleCPU scpu(CLK,Reset);
	initial begin
		CLK=	0;
		Reset=	0;	//åˆšå¼€å§‹è®¾ç½®pcä¸º0

		#50;	//ç­‰å¾…Resetå®Œæˆ
		CLK=	!CLK;	//ä¸‹é™æ²¿ï¼Œä½¿PCå…ˆæ¸…é›¶
		#50;
		Reset=	1;	//æ¸…é™¤ä¿æŒä¿¡å·
	  	forever #50 begin	//äº§ç”Ÿæ—¶é’Ÿä¿¡å·ï¼Œå‘¨æœŸä¸º50s
			CLK=	!CLK;
		end
	end
endmodule
</code></pre>

<h4 id="ä»¿çœŸæ³¢å½¢">ä»¿çœŸæ³¢å½¢</h4>

<p>æ³¢å½¢æ¯”è¾ƒé•¿ï¼Œåˆ†æˆä¸‰éƒ¨åˆ†é€ä¸€åˆ†æã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181122230102720.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p><img src="https://img-blog.csdnimg.cn/20181122230121763.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>å‰100psä¸ºåˆå§‹åŒ–ï¼Œå„å¯„å­˜å™¨çš„å€¼è¢«åˆå§‹åŒ–ä¸º0ã€‚</p>

<p>ç¬¬800psæ—¶æ‰§è¡Œäº†<code>bne $8,$1,-2</code>ï¼Œæ­¤æ—¶å¯„å­˜å™¨<code>$8</code>çš„å€¼æ˜¯4ï¼Œå¯„å­˜å™¨<code>$1</code>çš„å€¼æ˜¯8ï¼Œä¸¤è€…ä¸ç­‰ï¼Œå‘ç”Ÿäº†ä¸€æ­¥è·³è½¬ï¼Œäºæ˜¯ç¬¬900psçš„åœ°å€è·³è½¬åˆ°<code>00000018</code>ã€‚</p>

<p>åœ¨ç¬¬900pså‰å¯„å­˜å™¨1~11çš„å€¼ä¾æ¬¡ä¸ºï¼ˆ16è¿›åˆ¶ï¼‰<code>8,2,a,0,8,0,0,4,0,0,0</code>ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181122230759725.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p><img src="https://img-blog.csdnimg.cn/20181122230817389.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>ç¬¬1000psæ—¶å†æ¬¡æ‰§è¡Œäº†<code>bne $8,$1,-2</code>ï¼Œæ­¤æ—¶å¯„å­˜å™¨<code>$8</code>çš„å€¼æ˜¯<code>8</code>ï¼Œå¯„å­˜å™¨<code>$1</code>çš„å€¼æ˜¯<code>8</code>ï¼Œä¸¤è€…
ç›¸ç­‰ï¼Œpc+4æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>

<p>ç¬¬1400psæ—¶æ‰§è¡Œäº†<code>beq $7,$1,-2</code>ï¼Œæ­¤æ—¶å¯„å­˜å™¨<code>$7</code>çš„å€¼æ˜¯<code>8</code>ï¼Œå¯„å­˜å™¨<code>$1</code>çš„å€¼æ˜¯<code>8</code>ï¼Œä¸¤è€…ç›¸ç­‰ï¼Œå‘ç”Ÿäº†ä¸€æ­¥è·³è½¬ï¼Œäºæ˜¯ç¬¬1500psçš„åœ°å€è·³è½¬åˆ°<code>00000028</code>ã€‚</p>

<p>ç¬¬1600psæ—¶å†æ¬¡æ‰§è¡Œäº†<code>beq $7,$1,-2</code>ï¼Œæ­¤æ—¶å¯„å­˜å™¨<code>$7</code>çš„å€¼æ˜¯<code>10</code>ï¼Œå¯„å­˜å™¨<code>$1</code>çš„å€¼æ˜¯8ï¼Œä¸¤è€…ä¸ç­‰ï¼Œpc+4æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>

<p>åœ¨ç¬¬1800pså‰å¯„å­˜å™¨1~11çš„å€¼ä¾æ¬¡ä¸ºï¼ˆ16è¿›åˆ¶ï¼‰<code>8,2,a,0,8,1,10,8,0,0,0</code>ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123003947684.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p><img src="https://img-blog.csdnimg.cn/20181123004000191.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>ç¬¬2100psæ—¶æ‰§è¡Œäº†<code>bltz $10,-2</code>ï¼Œæ­¤æ—¶å¯„å­˜å™¨<code>$10</code>çš„å€¼æ˜¯<code>ffffffff</code>ï¼Œå°äº<code>0</code>ï¼Œå‘ç”Ÿäº†ä¸€æ­¥è·³è½¬ï¼Œäºæ˜¯ç¬¬2200psçš„åœ°å€è·³è½¬åˆ°<code>0000003c</code>ã€‚</p>

<p>ç¬¬2300psæ—¶å†æ¬¡æ‰§è¡Œäº†<code>bltz $10,-2</code>ï¼Œæ­¤æ—¶å¯„å­˜å™¨<code>$10</code>çš„å€¼æ˜¯<code>0</code>ï¼Œä¸å°äº<code>0</code>ï¼Œpc+4æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>

<p>ç¬¬2500psæ—¶æ‰§è¡Œäº†<code>j 0x00000050</code>ï¼Œäºæ˜¯ç¬¬2600psçš„åœ°å€è·³è½¬åˆ°<code>00000050</code>ã€‚</p>

<p>ç¬¬2600psæ—¶æ‰§è¡Œäº†<code>halt</code>ï¼Œç¨‹åºç»ˆæ­¢ï¼Œpcä¸å†è·³è½¬ã€‚</p>

<p>åœ¨ç¬¬2700pså‰å¯„å­˜å™¨1~11çš„å€¼ä¾æ¬¡ä¸ºï¼ˆ16è¿›åˆ¶ï¼‰<code>8,2,a,0,8,1,10,8,2,0,2</code>ã€‚</p>

<h3 id="çƒ§å†™åˆ°basys3å®éªŒæ¿">çƒ§å†™åˆ°Basys3å®éªŒæ¿</h3>

<h4 id="basys3v">Basys3.v</h4>

<p>é¡¶å±‚æ¨¡å—ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module Basys3(
	input CLK,
	input[1:0] SW,	//é€‰æ‹©è¾“å‡ºä¿¡å·
	input Reset,	//é‡ç½®æŒ‰é’®
	input Button,	//å•è„‰å†²
	output reg[3:0] AN,	//æ•°ç ç®¡ä½é€‰æ‹©ä¿¡å·
	output[7:0] Out	//æ•°ç ç®¡è¾“å…¥ä¿¡å·
);
	parameter T1MS=	100000;
	reg[16:0] showCounter;
	wire[31:0] ALU_Out;	//ALUçš„resultè¾“å‡ºå€¼
	wire[31:0] CurPC;
	wire[31:0] WriteData;	//DBæ€»çº¿å€¼
	wire[31:0] Reg1Out;	//å¯„å­˜å™¨ç»„rså¯„å­˜å™¨çš„å€¼
	wire[31:0] Reg2Out;	//å¯„å­˜å™¨ç»„rtå¯„å­˜å™¨çš„å€¼
	wire[31:0] instcode;
	wire myCLK;
	reg[3:0] store;	//è®°å½•å½“å‰è¦æ˜¾ç¤ºä½çš„å€¼
	wire[31:0] newAddress;

	SingleCPU scpu(myCLK,Reset,CurPC,newAddress,instcode,Reg1Out,Reg2Out,ALU_Out,WriteData);

	Debounce debounce(CLK,Button,myCLK);

	initial begin
		showCounter&lt;=	0;
		AN&lt;=	4'b0111;
	end
	always@(posedge CLK)
		begin
		if(Reset==0)begin
		  showCounter&lt;=	0;
		  AN&lt;=	4'b0000;
		end else begin
			showCounter&lt;=	showCounter+1;
			if(showCounter==T1MS)
				begin
					showCounter&lt;=	0;
					case(AN)
						4'b1110:	begin
							AN&lt;=	4'b1101;
						end
						4'b1101:	begin
							AN&lt;=	4'b1011;
						end
						4'b1011:	begin
							AN&lt;=	4'b0111;
						end
						4'b0111:	begin
							AN&lt;=	4'b1110;
						end
						4'b0000:	begin
							AN&lt;=	4'b0111;
					   end
					endcase
				end
			end
		end
	SegLED led(store,Reset,Out);
	always@(myCLK)begin
	   case(AN)
			4'b1110:	begin
				case(SW)
					2'b00:	store&lt;=	newAddress[3:0];
					2'b01:	store&lt;=	Reg1Out[3:0];
					2'b10:	store&lt;=	Reg2Out[3:0];
					2'b11:	store&lt;=	WriteData[3:0];
				endcase
			end
			4'b1101:	begin
				case(SW)
					2'b00:	store&lt;=	newAddress[7:4];
					2'b01:	store&lt;=	Reg1Out[7:4];
					2'b10:	store&lt;=	Reg2Out[7:4];
					2'b11:	store&lt;=	WriteData[7:4];
				endcase
			end
			4'b1011:	begin
				case(SW)
					2'b00:	store&lt;=	CurPC[3:0];
					2'b01:	store&lt;=	instcode[24:21];
					2'b10:	store&lt;=	instcode[19:16];
					2'b11:	store&lt;=	ALU_Out[3:0];
				endcase
			end
			4'b0111 : begin
				case(SW)
					2'b00:	store&lt;=	CurPC[7:4];
					2'b01:	store&lt;=	{3'b000,instcode[25]};
					2'b10:	store&lt;=	{3'b000,instcode[20]};
					2'b11:	store&lt;=	ALU_Out[7:4];
				endcase
			end
		endcase
	end
endmodule

</code></pre>

<h4 id="debouncev">Debounce.v</h4>

<p>æŒ‰é”®æ¶ˆæŠ–æ¨¡å—ã€‚Basys3æ¿é‡‡ç”¨çš„æ˜¯æœºæ¢°æŒ‰é”®ï¼Œåœ¨æŒ‰ä¸‹æŒ‰é”®æ—¶æŒ‰é”®ä¼šå‡ºç°äººçœ¼æ— æ³•è§‚æµ‹ä½†æ˜¯ç³»ç»Ÿä¼šæ£€æµ‹åˆ°çš„æŠ–åŠ¨å˜åŒ–ï¼Œè¿™å¯èƒ½ä¼šä½¿çŸ­æ—¶é—´å†…ç”µå¹³é¢‘ç¹å˜åŒ–ï¼Œå¯¼è‡´ç¨‹åºæ¥æ”¶åˆ°è®¸å¤šé”™è¯¯çš„è§¦å‘ä¿¡å·è€Œå‡ºç°è®¸å¤šä¸å¯çŸ¥çš„é”™è¯¯ã€‚æ¶ˆæŠ–æ“ä½œæ˜¯æ¯å½“æ£€æµ‹åˆ°CLKä¸Šå‡æ²¿åˆ°æ¥æ—¶æ£€æµ‹ä¸€æ¬¡å½“å‰ç”µå¹³ä¿¡å·å¹¶è®°å½•ï¼ŒåŒè®¡æ•°å™¨å¼€å§‹è®¡æ•°ï¼Œè‹¥åœ¨è®¡æ•°å™¨è¾¾åˆ°5000ä¹‹å‰ç”µå¹³å‘ç”Ÿå˜åŒ–ï¼Œåˆ™å°†è®¡æ•°å™¨æ¸…é›¶ï¼Œè‹¥è¾¾åˆ°5000ï¼Œåˆ™å°†è¯¥è®°å½•ç”µå¹³å–åè¾“å‡ºã€‚</p>

<p>å› ä¸ºç¨‹åºå¼€å§‹æ—¶å·²ç»è¿è¡Œç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œä¸ºé¿å…è·³è¿‡ç¬¬ä¸€æ¡æŒ‡ä»¤è®¡ç®—å€¼çš„å†™å…¥ï¼Œæˆ‘ä»¬çš„è¾“å…¥éœ€è¦ä»ä¸‹é™æ²¿å¼€å§‹ï¼Œå› æ­¤æˆ‘ä»¬ç»™æŒ‰é”®ä¿¡å·å–ååå†è¾“å…¥ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module Debounce(clk,key_in,key_out);
	parameter SAMPLE_TIME=	5000;
	input clk;
	input key_in;
	output key_out;
	reg[21:0] count_low;
	reg[21:0] count_high;
	reg key_out_reg;

	always@(posedge clk)begin
		count_low&lt;=	key_in?0:count_low+1;
		count_high&lt;=	key_in?0:count_high+1;
		if(count_high == SAMPLE_TIME)
			key_out_reg&lt;=	1;
		else if(count_low == SAMPLE_TIME)
			key_out_reg&lt;=	0;
	end
	assign key_out=!key_out_reg;
endmodule
</code></pre>

<h4 id="segledv">SegLED.v</h4>

<p>æ•°ç ç®¡è¯‘ç æ¨¡å—ã€‚è¯‘ç æ¨¡å—å°†CPUè¿ç®—çš„ç»“æœè½¬æ¢æˆ7æ®µæ•°ç ç®¡ä¸­å„ä¸ªæ•°ç ç®¡æ˜¾ç¤ºæ‰€éœ€çš„é«˜ä½ç”µå¹³ä¿¡å·,è¯¥å•å…ƒçš„è¾“å…¥ä¸º4-bitä½å®½çš„äºŒè¿›åˆ¶æ•°ã€‚å…¶ä¸­ï¼Œä¸ƒæ®µæ•°ç ç®¡çš„å…«ä¸ªç”µå¹³æ§åˆ¶è¾“å‡ºä¸­æœ€ä½ä½æ˜¯å°æ•°ç‚¹çš„æ˜¾ç¤ºä¿¡å·ï¼Œä½†å°æ•°ç‚¹åœ¨CPUè¿è¡Œæ—¶æ²¡æœ‰ç”¨åˆ°ï¼Œæ°å¥½ç”¨äºæ ‡è®°ResetçŠ¶æ€ã€‚</p>

<pre><code class="language-verilog">`timescale 1ns / 1ps
module SegLED(
	input[3:0] Store,
	input Reset,
	output reg[7:0] Out
);
	always@(Store or Reset)begin
		if(Reset==0)begin
			Out=	8'b11111110;
		end
		else begin
			case(Store)
				4'b0000:	Out=	8'b00000011;	//0
				4'b0001:	Out=	8'b10011111;	//1
				4'b0010:	Out=	8'b00100101;	//2
				4'b0011:	Out=	8'b00001101;	//3
				4'b0100:	Out=	8'b10011001;	//4
				4'b0101:	Out=	8'b01001001;	//5
				4'b0110:	Out=	8'b01000001;	//6
				4'b0111:	Out=	8'b00011111;	//7
				4'b1000:	Out=	8'b00000001;	//8
				4'b1001:	Out=	8'b00001001;	//9
				4'b1010:	Out=	8'b00010001;	//A
				4'b1011:	Out=	8'b11000001;	//b
				4'b1100:	Out=	8'b01100011;	//C
				4'b1101:	Out=	8'b10000101;	//d
				4'b1110:	Out=	8'b01100001;	//E
				4'b1111:	Out=	8'b01110001;	//F
				default:	Out=	8'b00000000;	//all light
			endcase
		end
	end
endmodule
</code></pre>

<h4 id="è¿è¡Œç»“æœ">è¿è¡Œç»“æœ</h4>

<h5 id="ç«¯å£æ˜ å°„">ç«¯å£æ˜ å°„</h5>

<p><img src="https://img-blog.csdnimg.cn/20181221021436787.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<h5 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h5>

<p><img src="https://img-blog.csdnimg.cn/20181123000309833.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" />
æ‰€æœ‰å¯„å­˜å™¨è¢«åˆå§‹åŒ–ä¸º0ã€‚</p>

<h5 id="ç¬¬1æ¡æŒ‡ä»¤addiu-108">ç¬¬1æ¡æŒ‡ä»¤<code>addiu $1,$0,8</code></h5>

<p><img src="https://img-blog.csdnimg.cn/20181123011128236.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>å½“å‰åœ°å€00ï¼Œä¸‹ä¸€åœ°å€04ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123000510362.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>0å·å¯„å­˜å™¨ï¼Œå€¼ä¸º0ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123000547592.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>1å·å¯„å­˜å™¨ï¼Œå€¼ä¸º0ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123000603914.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>ALUç»“æœä¸º8ã€‚</p>

<h5 id="ç¬¬2æ¡æŒ‡ä»¤ori-202">ç¬¬2æ¡æŒ‡ä»¤<code>ori $2,$0,2</code></h5>

<p><img src="https://img-blog.csdnimg.cn/20181123000721103.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>å½“å‰åœ°å€04ï¼Œä¸‹ä¸€åœ°å€08ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001020869.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>0å·å¯„å­˜å™¨ï¼Œå€¼ä¸º0ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123000752269.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>2å·å¯„å­˜å™¨ï¼Œå€¼ä¸º0ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123000810549.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>ALUç»“æœä¸º2ã€‚</p>

<h5 id="ç¬¬3æ¡æŒ‡ä»¤add-321">ç¬¬3æ¡æŒ‡ä»¤<code>add $3,$2,$1</code></h5>

<p><img src="https://img-blog.csdnimg.cn/20181123001052265.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>å½“å‰åœ°å€08ï¼Œä¸‹ä¸€åœ°å€0cã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001110157.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>2å·å¯„å­˜å™¨ï¼Œå€¼ä¸º2ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001133547.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>1å·å¯„å­˜å™¨ï¼Œ3å·å¯„å­˜å™¨ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001153288.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>è¾“å‡ºç»“æœä¸º0aã€‚</p>

<h5 id="ç¬¬4æ¡æŒ‡ä»¤sub-532">ç¬¬4æ¡æŒ‡ä»¤<code>sub $5,$3,$2</code></h5>

<p><img src="https://img-blog.csdnimg.cn/20181123001331443.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>å½“å‰åœ°å€0cï¼Œä¸‹ä¸€åœ°å€10ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001354103.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>3å·å¯„å­˜å™¨ï¼Œå€¼ä¸º0aã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001418748.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>2å·å¯„å­˜å™¨ï¼Œå€¼ä¸º2ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123001502544.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>ALUç»“æœä¸º8ã€‚</p>

<h5 id="ç¬¬5æ¡æŒ‡ä»¤and-452">ç¬¬5æ¡æŒ‡ä»¤<code>and $4,$5,$2</code></h5>

<p><img src="https://img-blog.csdnimg.cn/20181123001916826.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>å½“å‰åœ°å€10ï¼Œä¸‹ä¸€åœ°å€14ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123002013589.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>5å·å¯„å­˜å™¨ï¼Œå€¼ä¸º3ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123002039156.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>2å·å¯„å­˜å™¨ï¼Œå€¼ä¸º2ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20181123002103393.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<p>ALUç»“æœä¸º0ã€‚</p>

<h2 id="å®éªŒå¿ƒå¾—">å®éªŒå¿ƒå¾—</h2>

<p>å¯¹äºç¬¬ä¸€æ¬¡ä½¿ç”¨verilogè¯­è¨€çš„æˆ‘æ¥è¯´ï¼Œè®¾è®¡å•å‘¨æœŸCPUæ˜¯ä¸€ä¸ªä¸å°çš„æŒ‘æˆ˜ã€‚æ€»çš„æ¥è¯´ï¼Œä»å¼€å§‹æ„æ€åˆ°çœŸæ­£å†™æ¿å®Œæˆå¤§çº¦ç”¨äº†ä¸‰æ•´å¤©çš„æ—¶é—´ï¼ŒæœŸé—´é‡åˆ°äº†å¾ˆå¤šæœ‰å›°éš¾çš„åœ°æ–¹ï¼Œä¹Ÿç¿»äº†å¾ˆå¤šç½‘ä¸Šçš„åšå®¢ã€‚ä¸å¾—ä¸è¯´ï¼Œç½‘ä¸Šèƒ½æ‰¾åˆ°çš„å¾ˆå¤šåšå®¢ç»™å‡ºçš„ä»£ç éƒ½æ˜¯æœ‰äº›é—®é¢˜çš„ï¼Œç¡®å®åœ¨ä¸€å®šç¨‹åº¦ä¸Šè¯¯å¯¼äº†è‡ªå·±ã€‚ä½†æ˜¯è¿™æ ·ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç³»ç»Ÿåˆç¡®å®å¾ˆéš¾ä»€ä¹ˆéƒ½ä¸å»å‚è€ƒè€Œç›´æ¥å†™å‡ºæ¥ã€‚</p>

<p>å› æ­¤ï¼Œè¿˜æ˜¯å¸Œæœ›è€å¸ˆèƒ½å¤Ÿå¤šåšä¸€äº›æœ‰å…³verilogè¯­è¨€çš„è®²å­¦å§ï¼Œé‡åˆ°çš„å¾ˆå¤šé—®é¢˜å…¶å®éƒ½æ˜¯å…³äºè¯­æ³•æ–¹é¢çš„ï¼Œå› ä¸ºvivadoå¹¶ä¸ä¼šå¯¹è¯­æ³•é”™è¯¯è¿›è¡Œæç¤ºï¼ˆæˆ‘ç”¨çš„2017.4ç‰ˆä¼šåœ¨å¯èƒ½é”™è¯¯çš„åœ°æ–¹ç”»ä¸€é“æ³¢æµªçº¿ä½†æ˜¯å¹¶ä¸ä¼šæç¤ºé”™åœ¨å“ªé‡Œï¼‰ï¼Œè€Œæˆ‘é‡åˆ°çš„é—®é¢˜å¾ˆå¤šéƒ½æ˜¯è¯­æ³•æ–¹é¢çš„ï¼ˆä¾‹å¦‚ï¼Œåœ¨readmembçš„æ—¶å€™åœ°å€çš„æ–œæ å’Œæ“ä½œç³»ç»Ÿçš„æ˜¯åçš„ï¼Œè¿™èŠ±è´¹äº†æˆ‘å¾ˆå¤šæ—¶é—´æ£€æŸ¥æ‰å‘ç°ï¼‰ã€‚</p>
:ET