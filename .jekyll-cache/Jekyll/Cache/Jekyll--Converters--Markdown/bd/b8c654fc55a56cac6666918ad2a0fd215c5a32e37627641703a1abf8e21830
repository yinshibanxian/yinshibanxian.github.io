I"<h4 id="ä¸€-æ”¯ä»˜">ä¸€ã€ æ”¯ä»˜</h4>
<pre><code>å¾®ä¿¡å°ç¨‹åºäº‘å¼€å‘å®ç°æ”¯ä»˜ï¼Œé‡‡ç”¨çš„æ˜¯tenpayåº“ã€‚npmåº“é“¾æ¥ä¸º[tenpay]:https://www.npmjs.com/package/tenpayã€‚äº‘å¼€å‘ç¯å¢ƒæš‚ä¸”ä¸è¡¨ï¼Œå®ç°æ­¥éª¤å¦‚ä¸‹ï¼š
</code></pre>

<ol>
  <li>æ–°å»ºä¸€ä¸ªåç§°ä¸ºpayçš„äº‘å‡½æ•°</li>
  <li>ç»ˆç«¯æ‰“å¼€äº‘å‡½æ•°ï¼Œåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹ä¸¤æ¡å‘½ä»¤ï¼šnpm i wx-server-sdk npm i tenpay</li>
  <li>äº‘å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>

<pre><code>  //äº‘å¼€å‘å®ç°æ”¯ä»˜
  const cloud = require('wx-server-sdk')
  cloud.init()
  //1ï¼Œå¼•å…¥æ”¯ä»˜çš„ä¸‰æ–¹ä¾èµ–
  const tenpay = require('tenpay');
  //2ï¼Œé…ç½®æ”¯ä»˜ä¿¡æ¯
  const config = {
    appid: 'è¿™é‡Œå¡«å°ç¨‹åºçš„appid',
    mchid: 'è¿™é‡Œå¡«å¾®ä¿¡å•†æˆ·å·id',
    partnerKey: 'è¿™é‡Œå¡«å¾®ä¿¡å•†æˆ·çš„æ”¯ä»˜å¯†é’¥',
    notify_url: 'https://mp.weixin.qq.com', // è¿™é‡Œå¡«ä»»æ„å…¬ç½‘å¯è®¿é—®çš„ipå³å¯,å¦‚æ­¤å¤„çš„https://mp.weixin.qq.com
    spbill_create_ip: '127.0.0.1' //è¿™é‡Œå¡«è¿™ä¸ªå°±å¯ä»¥
  };

exports.main = async (event, context) =&gt; {
    const wxContext = cloud.getWXContext()
    let {
        total_fee
    } = event;
    //3ï¼Œåˆå§‹åŒ–æ”¯ä»˜
    const api = tenpay.init(config);
    const nonceStr = Math.random().toString(36).substr(2, 15)
    const timeStamp = parseInt(Date.now() / 1000) + ''
    const out_trade_no = "otn" + nonceStr + timeStamp
    let result = await api.getPayParams({
        out_trade_no: out_trade_no,  // è¿™é‡Œå¡«çš„æ˜¯å•†æˆ·å·ä¸­çš„è®¢å•å·
        body: 'ç‰Œä½', // è¿™é‡Œå¡«å†™çš„æ˜¯ä»˜æ¬¾ä¿¡æ¯
        total_fee: total_fee, //è®¢å•é‡‘é¢(åˆ†),
        openid: wxContext.OPENID //ä»˜æ¬¾ç”¨æˆ·çš„openid
    });
    return result;
}
</code></pre>

:ET